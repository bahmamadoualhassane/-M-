const axios = require('axios');

module.exports = {
    config: {
        name: "Ã¢ge",
        aliases: ["anniversaire", "date de naissance"],
        version: "1.0", 
        author: "Ã‘Ã…Å˜ÃœÅ¢Ã˜ Å°Å¹Å®MÄ€Ä¶ÃŒ",
        description: {
            vi: "Láº¥y thÃ´ng tin tuá»•i dá»±a trÃªn ngÃ y sinh.",
            en: "Obtenir des informations sur l'Ã¢ge en fonction de la date de naissance."
        },
        category: "UTILITAIRE",
        guide: {
            vi : "{pn} <ngÃ y sinh (JJ-MM-AAAA)>",
            fr : "{pn} <date de naissance (JJ-MM-AAAA)>"
        }
    },

    onStart: async function ({ api, args, event }) {
        const birthdate = args[0];

        try {
            const response = await axios.get(`https://rubish-apihub.onrender.com/rubish/agecalculator?birthdate=${birthdate}&apikey=rubish69`);
            const data = response.data;

            const formattedResponse = `
â•Ÿ ğ—”ğ—šğ—˜ ğ—œğ—¡ğ—™ğ—¢ğ—¥ğ— ğ—”ğ—§ğ—œğ—¢ğ—¡ â•¢
ï¹Œï¹Œï¹Œï¹Œï¹Œï¹Œï¹Œï¹Œï¹Œï¹Œï¹Œï¹Œï¹Œï¹Œ
ğŸ“… Date d naissance : ${birthdate}

ğŸ‚ Ã‚ge : ${data.ageData.age.years} ans ${data.ageData.age.months} â€‹â€‹mois ${data.ageData.age.days} jours

ğŸ“… Ã‚ge total :
  - AnnÃ©es : ${data.ageData.totalAge.years}
  - Mois : ${data.ageData.totalAge.months}
  - Semaines : ${data.ageData.totalAge.weeks}
  - Jours : ${data.ageData.totalAge.days}
  - Heures : ${data.ageData.totalAge.hours}
  - Minutes : ${data.ageData.totalAge.minutes}
  - Secondes : ${data.ageData.totalAge.seconds}

ğŸ‰ Prochain anniversaire : ${data.ageData.nextBirthday.dayName}, ${data.ageData.nextBirthday.remainingMonths} â€‹â€‹mois ${data.ageData.nextBirthday.remainingDays} jours

ğŸ–¼ URL d l'image : ${data.imgbbImageUrl}
`;

            if (typeof data.imgbbImageUrl === 'string' && data.imgbbImageUrl) {
                const attachment = await global.utils.getStreamFromURL(data.imgbbImageUrl);
                await api.sendMessage({
                    body: formattedResponse,
                    attachment
                }, event.threadID);
            } else {
                await api.sendMessage({
                    body: formattedResponse
                }, event.threadID);
            }
        } catch (error) {
            console.error('Erreur lors de la rÃ©cupÃ©ration des donnÃ©es dÃ¢ge:', error);
            api.sendMessage("Une erreur s'est produite lors du traitement de la demande.", event.threadID);
        }
    }
};
